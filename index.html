<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conéctese a MetaMask</title>
    <link rel="stylesheet" href="styles.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>

<body>
    <div class="center-container">
        <!-- Título -->
        <h1>Conéctese a MetaMask</h1>

        <!-- Botón de conexión -->
        <button id="connectButton">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTpWQRvm47HFXtb7DoDy8-4amlF5DV2m3oGkw&s"
                alt="MetaMask Icon" class="icon">
            Conectar MetaMask
        </button>

        <!-- Mensaje de estado -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Sección de Información Adicional, Guía de Instalación, Preguntas Frecuentes, Soporte y Contacto -->
        <div class="grid-container">
            <!-- Información Adicional -->
            <div class="card info-section">
                <h2>¿Qué es MetaMask?</h2>
                <p>MetaMask es una billetera de criptomonedas y una extensión de navegador que te permite interactuar
                    con la blockchain de Ethereum y otras redes compatibles. Es una herramienta esencial para gestionar
                    tus activos digitales y participar en aplicaciones descentralizadas (dApps).</p>
            </div>

            <!-- Guía de Instalación -->
            <div class="card install-guide">
                <h2>¿Cómo instalar MetaMask?</h2>
                <p>Para instalar MetaMask, sigue estos pasos:</p>
                <ol>
                    <li>Visita el sitio web de <a href="https://metamask.io/" target="_blank">MetaMask</a>.</li>
                    <li>Descarga la extensión para tu navegador (Chrome, Firefox, Brave, etc.).</li>
                    <li>Instala la extensión y sigue las instrucciones para crear una nueva billetera o restaurar una
                        existente.</li>
                </ol>
            </div>

            <!-- Preguntas Frecuentes -->
            <div class="card faq">
                <h2>Preguntas Frecuentes</h2>
                <div class="faq-item">
                    <h3>¿Qué hago si no puedo conectar con MetaMask?</h3>
                    <p>Verifica que MetaMask esté instalado y que tu navegador esté actualizado. También asegúrate de
                        que la conexión a internet esté funcionando correctamente.</p>
                </div>
                <div class="faq-item">
                    <h3>¿Cómo sé si mi conexión es segura?</h3>
                    <p>MetaMask te mostrará un aviso cuando la conexión sea segura. Además, asegúrate de que estés en un
                        sitio web confiable y no compartas tu clave privada con nadie.</p>
                </div>
            </div>

            <!-- Soporte y Contacto -->
            <div class="card support">
                <h2>¿Necesitas ayuda?</h2>
                <p>Si necesitas más asistencia, no dudes en <a href="mailto:support@example.com">contactar con nuestro
                        soporte</a>. Estamos aquí para ayudarte.</p>
            </div>
        </div>

        <!-- SVG para Ethereum -->
        <svg height="210" width="500">
            <polygon points="50,10 0,110 50,130 100,110" id="base_left" />
            <polygon points="50,10 50,130 50,130 100,110" id="base_right" />
            <polygon points="50,130 0,110 50,70 100,110" id="base_bottom" />

            <polygon points="50,170 0,120 50,140 100,120" id="bottom_left" />
            <polygon points="50,170 50,120 50,140 100,120" id="bottom_right" />

            <text x="130" y="100">
                Ethereum
            </text>

            <text x="130" y="130" id="about">
                BLOCKCHAIN APP PLATFORM
            </text>
        </svg>

        <!-- Información Adicional de MetaMask -->
        <div id="content">
            <ul>
                <li><strong>Your Address:</strong> <code id="address">0x0000000000000000000000000000000000000000</code></li>
                <li><strong>Transactions:</strong> <span id="transactions">No Transactions Found</span></li>
                <li><strong>Balance:</strong> <span id="balance">0 Ether</span></li>
            </ul>
        </div>
    </div>

    <!-- Cargar Web3 desde un CDN -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <!-- Cargar SweetAlert2 desde un CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <!-- Tu script de aplicación -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const connectButton = document.getElementById('connectButton');
            const statusMessage = document.getElementById('statusMessage');
            const addressElement = document.getElementById('address');
            const transactionsElement = document.getElementById('transactions');
            const balanceElement = document.getElementById('balance');

            connectButton.addEventListener('click', async () => {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        // Solicitar acceso a la cuenta de MetaMask
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        const account = accounts[0];

                        // Crear una instancia de Web3 con la billetera de MetaMask
                        const web3 = new Web3(window.ethereum);

                        // Obtener la dirección de la cuenta
                        const address = account;

                        // Obtener el saldo de la cuenta
                        const balanceWei = await web3.eth.getBalance(address);
                        const balanceEther = web3.utils.fromWei(balanceWei, 'ether');

                        // Obtener el número de transacciones (Ejemplo; este valor debe ser reemplazado por la lógica real si está disponible)
                        const transactionsCount = 0; // Ajustar según la lógica real de tu aplicación

                        // Mostrar un mensaje usando SweetAlert
                        Swal.fire({
                            title: 'Conectado',
                            text: '¡Conectado a MetaMask exitosamente!',
                            icon: 'success',
                            confirmButtonText: 'Aceptar'
                        });

                        // Actualizar el contenido
                        addressElement.textContent = address;
                        transactionsElement.textContent = transactionsCount > 0 ? `${transactionsCount} (5 Internal)` : 'No Transactions Found';
                        balanceElement.textContent = `${balanceEther} Ether`;

                        // Mostrar un mensaje de estado
                        statusMessage.textContent = '¡Conectado a MetaMask exitosamente!';
                        statusMessage.style.backgroundColor = '#d4edda'; // Green
                        statusMessage.style.color = '#155724'; // Dark Green
                        console.log("Conectado a MetaMask");
                    } catch (error) {
                        // Mostrar un mensaje de error usando SweetAlert
                        Swal.fire({
                            title: 'Error',
                            text: `¡Error al conectar con MetaMask! ${error.message}`,
                            icon: 'error',
                            confirmButtonText: 'Aceptar'
                        });

                        // Mostrar un mensaje de estado
                        statusMessage.textContent = `¡Error al conectar con MetaMask! ${error.message}`;
                        statusMessage.style.backgroundColor = '#f8d7da'; // Red
                        statusMessage.style.color = '#721c24'; // Dark Red
                        console.error("Conexión fallida:", error);
                    }
                } else {
                    // Mostrar un mensaje de advertencia usando SweetAlert
                    Swal.fire({
                        title: 'No detectado',
                        text: '¡MetaMask no está instalado! Por favor, instala MetaMask y vuelve a intentarlo.',
                        icon: 'warning',
                        confirmButtonText: 'Aceptar'
                    });

                    // Mostrar un mensaje de estado
                    statusMessage.textContent = '¡MetaMask no está instalado! Por favor, instala MetaMask y vuelve a intentarlo.';
                    statusMessage.style.backgroundColor = '#fff3cd'; // Yellow
                    statusMessage.style.color = '#856404'; // Dark Yellow
                    console.warn("MetaMask no está instalado");
                }
            });
        });
    </script>
</body>

</html>
